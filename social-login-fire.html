<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymerfire/firebase-auth.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<dom-module id="social-login-fire">
<template>
<style>
    :host {
    @apply(--layout-vertical);
    @apply(--layout-center);
    margin: 0 auto;
    text-align: center;
    margin: 0 auto;
    }

    :host(.horizontal) {
    @apply(--layout-horizontal);
    @apply(--layout-wrap);
    @apply(--layout-around-justified);
    max-width: inherit;
    }

    firebase-auth{
    display: none;
    }
    .signInButton img{
    padding: 0 8px 0 2px;
    max-height: 15px;
    }
    .signInButton{
    width: 220px;
    text-align: left;
    margin-bottom: 15px;
    text-transform: none;
    min-height: 40px;
    }
    .signInButton.mini {
    width: 150px;
    }
    #googSignIn{
    background-color: white;
    }
    #fbSignIn{
    background-color: #3B5999;
    color: white;
    }
    #twtrSignIn{
    background-color: #55ACEE;
    color: white;
    }
    #ghSignIn{
    background-color: #F5F5F5
    }
    #anonSignIn{
    background-color: #303030;
    color: white;
    }
    #fbSignIn:hover{
    background-color: #4265b0;
    }
    #twtrSignIn:hover{
    background-color: #5cb9ff;
    }
    #ghSignIn:hover{
    background-color: white;
    }
    #anonSignIn:hover{
    background-color: #414040;
    }
</style>

<firebase-auth app-name="{{appName}}" id="google" provider="google" user="{{googleUser}}" signed-in="{{googleSignedIn}}" status-known={{googleStatusKnown}}>
</firebase-auth>
<firebase-auth app-name="{{appName}}" id="facebook" provider="facebook" user="{{facebookUser}}" signed-in="{{facebookSignedIn}}" status-known={{facebookStatusKnown}}>
</firebase-auth>
<firebase-auth app-name="{{appName}}" id="twitter" provider="twitter" user="{{twitterUser}}" signed-in="{{twitterSignedIn}}" status-known={{twitterStatusKnown}}>
</firebase-auth>
<firebase-auth app-name="{{appName}}" id="github" provider="github" user="{{githubUser}}" signed-in="{{githubSignedIn}}" status-known={{githubStatusKnown}}>
</firebase-auth>
<firebase-auth app-name="{{appName}}" id="anonymous" user="{{anonUser}}" signed-in="{{anonSignedIn}}" status-known={{anonStatusKnown}}>
</firebase-auth>


<template is="dom-if" if={{debug}}>
    <div class="debug">
    <div> user.id = {{user.uid}}</div>
    <div> signedIn = {{signedIn}}</div>
    <div> statusKnown = {{statusKnown}}</div>
    <div> user.displayName = {{user.displayName}}</div>
    <div> user.email = {{user.email}}</div>
    <div> user.emailVerified = {{user.emailVerified}}</div>
    <div> user.isAnonymous = {{user.isAnonymous}}</div>
    <div> user.photoURL = {{user.photoURL}} <img src$="{{user.photoURL}}" hidden="{{!user.photoURL}}" width="100px" height="100px"> </div>
    <div> user.providerId = {{user.providerId}}</div>
    <paper-button on-tap="signOut">Log Out</paper-button>
    </div>
</template>


    <template is="dom-if" if="{{google}}">
    <paper-button id="googSignIn" class$="signInButton {{_getMiniClass()}}" on-tap="_signIn" data-auth="#google" raised>

        <div style="width:15px; height:15px; padding: 0 8px 0 2px;">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                viewBox="0 0 123.3 126.2" style="enable-background:new 0 0 123.3 126.2;" xml:space="preserve">
            <style type="text/css">
                .st0{clip-path:url(#SVGID_2_);fill:#F9BC15;}
                .st1{clip-path:url(#SVGID_4_);fill:#EA4535;}
                .st2{clip-path:url(#SVGID_6_);fill:#36A852;}
                .st3{clip-path:url(#SVGID_8_);fill:#557EBF;}
            </style><g><g><defs>
                <path id="SVGID_1_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                    s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                    c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                </defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible;"/></clipPath><polygon class="st0" points="-5.7,100.4 -5.7,25.8 43,63.1 "/></g><g><defs>
                <path id="SVGID_3_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                    s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                    c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                </defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible;"/></clipPath><polygon class="st1" points="-5.7,25.8 43,63.1 63.1,45.6 132,34.4 132,-5.7 -5.7,-5.7"/></g><g><defs>
                <path id="SVGID_5_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                    s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                    c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                </defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_"  style="overflow:visible;"/></clipPath><polygon class="st2" points="-5.7,100.4 80.3,34.4 103,37.3 132,-5.7 132,132 -5.7,132"/></g><g><defs>
                    <path id="SVGID_7_" d="M121.9,51.6h-7.2H91.2H63.1V76H97c-3.2,15.5-16.4,24.4-33.8,24.4c-20.7,0-37.3-16.6-37.3-37.3
                    s16.6-37.3,37.3-37.3c8.9,0,16.9,3.2,23.2,8.3l18.4-18.4C93.5,6,79.2,0,63.1,0C28.1,0,0,28.1,0,63.1s28.1,63.1,63.1,63.1
                    c31.6,0,60.2-22.9,60.2-63.1C123.3,59.4,122.8,55.4,121.9,51.6z"/>
                </defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_"  style="overflow:visible;"/></clipPath><polygon class="st3" points="132,132 43,63.1 31.6,54.5 132,25.8"/></g></g>
            </svg>
        </div>
        {{_getButtonText()}}Google</paper-button>
    </template>
    <template is="dom-if" if="{{facebook}}">
    <paper-button id="fbSignIn" class$="signInButton {{_getMiniClass()}}" on-tap="_signIn" data-auth="#facebook" raised>
        <div style="width:15px; height:15px">
            <svg viewBox="0 0 7.94 16.74" style="height:15px;fill:white;">
                <path d="M5.39,16.79H2.29V8.52H0.22V5.67H2.29V4c0-2.32.63-3.74,3.37-3.74H7.94V3.1H6.51c-1.07,0-1.12.4-1.12,1.14V5.67H8L7.65,8.52H5.39v8.27Z" transform="translate(-0.12 -0.15)" style="stroke:#000;stroke-miterlimit:10;stroke-width:0.20000000298023224px"/>
            </svg>
        </div>
        {{_getButtonText()}}Facebook</paper-button>
    </template>
    <template is="dom-if" if="{{twitter}}">
    <paper-button id="twtrSignIn" class$="signInButton {{_getMiniClass()}}" on-tap="_signIn" data-auth="#twitter" raised>
        <div style="width:15px; height:15px; padding: 0 8px 0 2px;">
            <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20.34 16.17">
            <path d="M6.85,16.34A11.39,11.39,0,0,0,18.32,4.87q0-.26,0-0.52a8.2,8.2,0,0,0,2-2.09A8,8,0,0,1,18,2.9,4,4,0,0,0,19.77.67a8.08,8.08,0,0,1-2.56,1,4,4,0,0,0-6.87,3.68A11.44,11.44,0,0,1,2,1.11,4,4,0,0,0,3.29,6.49,4,4,0,0,1,1.46,6s0,0,0,.05a4,4,0,0,0,3.23,4,4,4,0,0,1-1.82.07,4,4,0,0,0,3.77,2.8,8.09,8.09,0,0,1-5,1.73,8.19,8.19,0,0,1-1-.06,11.41,11.41,0,0,0,6.18,1.81" transform="translate(-0.25 -0.27)" style="fill:white"/></svg>
        </div>
        {{_getButtonText()}}Twitter  </paper-button>
    </template>
    <template is="dom-if" if="{{github}}">
    <paper-button id="ghSignIn" class$="signInButton {{_getMiniClass()}}" on-tap="_signIn" data-auth="#github" raised>
        <div style="width:15px; height:15px; padding: 0 8px 0 2px;">
            <svg  viewBox="0 0 16.73 16.32" style="height:15px;fill:black;">
                <path d="M11.46,16.53a1.53,1.53,0,0,1-.25.08,0.41,0.41,0,0,1-.53-0.44c0-.61,0-1.22,0-1.83a2.6,2.6,0,0,0-.54-2c0.32-.06.6-0.1,0.88-0.16a3.45,3.45,0,0,0,2.9-3.49,3.53,3.53,0,0,0-.76-2.64,0.32,0.32,0,0,1,0-.26,3.21,3.21,0,0,0-.08-1.88,0.24,0.24,0,0,0-.29-0.19,2.91,2.91,0,0,0-1.46.51,1.53,1.53,0,0,1-1.3.23,7.31,7.31,0,0,0-3.29.08,0.6,0.6,0,0,1-.4-0.08A5.23,5.23,0,0,0,4.7,3.79c-0.46-.09-0.5-0.07-0.62.38a3.09,3.09,0,0,0,0,1.68A0.34,0.34,0,0,1,4,6.11C2.8,7.46,3.24,10,4.06,11a3.92,3.92,0,0,0,2.41,1.28L7,12.36c-0.14.36-.27,0.71-0.41,1a0.35,0.35,0,0,1-.19.15,1.71,1.71,0,0,1-2.23-.74A1.74,1.74,0,0,0,3,11.94H2.9L2.47,12a1.17,1.17,0,0,0,.25.33,2.41,2.41,0,0,1,.95,1.18,1.82,1.82,0,0,0,1.68,1.17c0.38,0,.76,0,1.18,0,0,0.47,0,1,0,1.55,0,0.29-.3.4-0.65,0.29a7.56,7.56,0,0,1-2.52-1.4A8,8,0,0,1,.54,6.56,7.94,7.94,0,0,1,7.17.44,8.36,8.36,0,0,1,11.46,16.53ZM7,12.34v0H7ZM4.81,13.85A1.07,1.07,0,0,0,5,14a0.54,0.54,0,0,0,.18-0.13,1.63,1.63,0,0,0-.3-0.11A0.3,0.3,0,0,0,4.81,13.85ZM5.49,14a0.21,0.21,0,0,0,.17.11A0.42,0.42,0,0,0,5.83,14l-0.26-.23A0.6,0.6,0,0,0,5.49,14Zm0.83-.2a0.67,0.67,0,0,0-.19.13l0.14,0.17,0.2-.18A0.34,0.34,0,0,0,6.32,13.76Zm-2.06-.28a1.87,1.87,0,0,0,.18.24,0.7,0.7,0,0,0,.1-0.17,0.92,0.92,0,0,0-.19-0.17A0.29,0.29,0,0,0,4.26,13.48Z" transform="translate(-0.23 -0.3)"/>
            </svg>
        </div>
        {{_getButtonText()}}GitHub</paper-button>
    </template>
    <template is="dom-if" if="{{anonymous}}">
    <paper-button id="anonSignIn" class$="signInButton {{_getMiniClass()}}" on-tap="_signIn" data-auth="#anonymous" raised>
        <div style="width:15px; height:15px; padding: 0 8px 0 2px;">
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128.6 115.9"><title>anon</title><path d="M123.7,82.3c-4.7-6.1-11.4-8.3-15.5-9.1l17.1-21.5a2.19,2.19,0,0,0,.3-2.2,2,2,0,0,0-1.8-1.2l-12.1-.2a9.84,9.84,0,0,0,1.9-3.5c0.9-3.1.3-6.4-1.8-9.8-2.8-4.5-7.5-5.2-11.2-5.9-1.9-.3-3.7-0.6-4.6-1.3-1.1-.9-1.6-5.2-1.9-8.3-0.5-5.2-1-10.5-4.3-12.6A12,12,0,0,0,83,4.8a35.76,35.76,0,0,0-7.3,1.1,29.38,29.38,0,0,1-6.3,1,3.75,3.75,0,0,1-1.1-.1,61.31,61.31,0,0,1-8.2-2.2c-5.6-1.8-12.5-4-17.9-4a13.11,13.11,0,0,0-5.2.9c-4.5,1.9-5.1,8.4-5.6,14.7-0.3,3.7-.7,7.5-1.8,9.2-0.8,1.3-3.6,2.1-6.3,2.9-5,1.5-11.2,3.4-12.9,9.7C9,42.2,13.3,46.9,17,50L2.7,51.2A2,2,0,0,0,1,52.4a2.23,2.23,0,0,0,.2,2.1L18.6,77.8c-2.8,1.4-7.2,4-9.9,7.4-4.6,6.1-5.3,26.9-5.4,29.2a2,2,0,0,0,.6,1.5,2,2,0,0,0,1.4.6H5.4l122.1-6.9a1.91,1.91,0,0,0,1.4-.7,1.74,1.74,0,0,0,.5-1.5C129.5,105.5,128.4,88.3,123.7,82.3Zm-73.9-16c-1.9,2.9-5.4,8.9-12.7,5.9-8-3.2-13.8-19.2-7.5-17C33.8,56.6,44,59.5,50.5,60,51.8,60.1,50.7,64.9,49.8,66.3ZM67.1,76.8c-9,1.9-11.7-5.6-13.4-9.4-0.6-1.4-.9-7.3.6-7.1C61.9,61,74,59.8,79.1,59,86.8,57.7,76.9,74.7,67.1,76.8Zm22-38.3c-22.6,10.6-45.8,4.5-56-1-5-2.7-2-5.1,2-2.8,8.2,4.7,32,9,51.2,1C94.3,32.3,93.6,36.3,89.1,38.5Z" transform="translate(-0.83 -0.6)" style="fill:#fff"/></svg>
        </div>
        {{_getButtonText("anon")}}</paper-button>
    </template>



</template>

<script>
    /**
    * An element that allows simple configuration of multiple social provider login with
    * firebase.
    *
    * For email authentication only, use email-login-fire.
    *
    * For social provider authentication only, use social-login-fire.
    *
    * For both email and social provider authentication, use login-fire.
    *
    * Example:
    * ```
    * <firebase-app
    *   name="demo"
    *   api-key="API_KEY"
    *   auth-domain="AUTH_DOMAIN"
    *   database-url="DATABASE_URL"></firebase-app>
    * <!-- A social-login-fire element allowing twitter, google and facebook login -->
    * <social-login-fire app-name="demo" twitter google facebook></social-login-fire>
    * ```
    *
    *
    * @demo demo/social.html
    */
    Polymer({
    is: 'social-login-fire',
    properties: {
        /**
        * `appName` represents the name of the firebase-app that was instantiated
        */
        appName: {
        type: String
        },
        /**
        * `anonymous` represents whether to allow anonymous sign in
        */
        anonymous: {
        type: Boolean,
        value: false,
        },
        /**
        * `github` represents whether to allow github sign in. See the [firebase console](https://console.firebase.google.com) Auth tab for configuration
        */
        github: {
        type: Boolean,
        value: false,
        },
        /**
        * `twitter` represents whether to allow twitter sign in. See the [firebase console](https://console.firebase.google.com) Auth tab for configuration
        */
        twitter: {
        type: Boolean,
        value: false,
        },
        /**
        * `facebook` represents whether to allow facebook sign in. See the [firebase console](https://console.firebase.google.com) Auth tab for configuration
        */
        facebook: {
        type: Boolean,
        value: false,
        },
        /**
        * `google` represents whether to allow google sign in. See the [firebase console](https://console.firebase.google.com) Auth tab for configuration
        */
        google: {
        type: Boolean,
        value: false,
        },
        /**
        * `redirect` represents whether to use a redirect instead of a popup for signing in with the selected providers
        */
        redirect: {
        type: Boolean,
        value: false,
        },
        /**
        * `horizontal` represents whether to display the social buttons side by side or on top of each other
        */
        horizontal: {
        type: Boolean,
        value: false,
        observer: '_horizontalChanged',
        },
        /**
        * `mini` represents whether to display the social buttons with "Sign in with" or not
        */
        mini: {
        type: Boolean,
        value: false
        },
        /**
        * `user` represents the user object returned by the firebase-auth element
        */
        user: {
        type: Object,
        readOnly: true,
        notify: true,
        computed: "_computeUser(googleUser, facebookUser, twitterUser, githubUser, anonUser)",
        observer: "_userChanged",
        },
        /**
        * `signedIn` represents the signed in state returned by the firebase-auth element
        */
        signedIn: {
        type: Boolean,
        readOnly: true,
        notify: true,
        computed: "_computeSignedIn(googleSignedIn, facebookSignedIn, twitterSignedIn, githubSignedIn, anonSignedIn)",
        },
        /**
        * `statusKnown` represents the status known state returned by the firebase-auth element
        */
        statusKnown: {
          type: Boolean,
          notify: true,
          computed: "_computeStatusKnown(googleStatusKnown, facebookStatusKnown, twitterStatusKnown, githubStatusKnown, anonStatusKnown)",
        },
        /**
        * `debug` represents if the debug region is shown
        */
        debug: {
        type: Boolean,
        value: false,
        }
    },

    _getMiniClass: function(){
    return this.mini ? "mini" : "";
    },

    _getButtonText: function(a){
    if(this.mini){
        return a == "anon" ? "Anonymously" : "";
    } else {
        return a == "anon" ? "Sign in anonymously" : "Sign in with ";
    }
    },

    _horizontalChanged: function(newVal, oldVal){
    if (newVal){
        this.classList.add("horizontal");
    } else {
        this.classList.remove("horizontal")
    }
    },
    _computeUser: function(googleUser, facebookUser, twitterUser, githubUser, anonUser){
        if(this.googleSignedIn){return googleUser;}
        else if(this.facebookSignedIn){return facebookUser;}
        else if(this.twitterSignedIn){return twitterUser;}
        else if(this.githubSignedIn){return githubUser;}
        else if(this.anonSignedIn){return anonUser;}
        else {return {};}
    },
    _computeSignedIn: function(googleSignedIn, facebookSignedIn, twitterSignedIn, githubSignedIn, anonSignedIn){
        return googleSignedIn || facebookSignedIn || twitterSignedIn || githubSignedIn || anonSignedIn;
    },
    _computeStatusKnown: function(googleStatusKnown, facebookStatusKnown, twitterStatusKnown, githubStatusKnown, anonStatusKnown){
      return googleStatusKnown || facebookStatusKnown || twitterStatusKnown || githubStatusKnown || anonStatusKnown;
    },
    _userChanged: function(u){
        if(typeof u !== 'undefined' && u != null){
        if (!(Object.keys(u).length === 0 && u.constructor === Object)){
            this.fire("signedin", u);
        }
        }
    },
    _signIn: function(e) {
        var authId = e.target.getAttribute("data-auth");
        if(authId == "#anonymous"){
        this.$$(authId).signInAnonymously();
        } else if(this.redirect){
        this.$$(authId).signInWithRedirect();
        } else {
        this.$$(authId).signInWithPopup();
        }
    },
    /**
    * Signs out the signed in user
    */
    signOut: function(){
        if(this.googleSignedIn){this.$.google.signOut();}
        if(this.facebookSignedIn){this.$.facebook.signOut();}
        if(this.twitterSignedIn){this.$.twitter.signOut();}
        if(this.githubSignedIn){this.$.github.signOut();}
        if(this.anonSignedIn){this.$.anonymous.signOut();}
    }
    });
</script>
</dom-module>
