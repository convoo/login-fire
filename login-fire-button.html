<!--
@license
Copyright (c) 2016 Convoo All Rights Reserved.
Use of this source code is governed by a MIT license that can be found in the
LICENSE file or at https://github.com/convoo/login-fire/blob/master/LICENSE.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="./login-fire-social-behavior.html">
<link rel="import" href="../polymerfire/firebase-auth.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="./shared-styles.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="./icons.html">

<!--
`login-fire-button` is a button to authenticate a user with the [firebase-auth](https://elements.polymer-project.org/elements/polymerfire?active=firebase-auth)
element.

It can be used with the same providers as the [Firebase Auth API](https://firebase.google.com/docs/auth/).
The provider logo is displayed. It may be flat or raised. A raised button
is styled with a shadow. It can be mini or not. A mini button displays only
the provider logo and the text "Sign-in" / "Sign-out".

Example:
```
<login-fire-button app-name="myApp" provider="google"></login-fire-button>
<login-fire-button app-name="myApp" provider="facebook" flat></login-fire-button>
<login-fire-button app-name="myApp" provider="twitter" flat mini></login-fire-button>
```

### Styling

Style the buttons with CSS as you would a normal DOM element. 

The following custom properties and mixins are available for styling:

| Custom property | Description | Default |
| --- | --- | --- |
| `--login-fire-reset-password-color` | The color of reset password text | `gray` |
| `--login-fire-reset-password-hover-color` | The color of reset password text when hovered | `gray` |
| `--login-fire-error-msg-color` | The color for the error message  | `--error-color` |
| `--login-fire-info-msg-color` | The color for the info message | `gray` |
| `--login-fire-divider-color` | The color for the divider bar | `gray` |
| `--login-fire-background-color` | The color for the divider bar | `white` |
| `--login-fire-btn-signup` | Mixin applied to the signup button | `{}` |
| `--login-fire-btn-signin` | Mixin applied to the signin button | `{}` |
| `--login-fire-btn-signout` | Mixin applied to the signin button | `{}` |

@demo demo/login-fire-button.html
-->
<dom-module id="login-fire-button">
  <template>
    <style include="shared-styles">
      :host {
        display: inline-block;
        @apply(--login-fire-button);
      }
      .btn {
        width: 210px;
        text-align: left;
        text-transform: none;
        min-height: 40px;
        display: flex;
        @apply(--login-fire-button);
      }
      .btn--google{
          @apply(--login-fire-button-google)
      }
      .btn--twitter{
          @apply(--login-fire-button-twitter)
      }
      .btn--facebook{
          @apply(--login-fire-button-facebook)
      }
      .btn--github{
          @apply(--login-fire-button-github)
      }
      .btn--anonymous{
          @apply(--login-fire-button-anonymous)
      }
      .btn__icon {
        padding-left: 8px;
        width:30px;
        height: 14px;
        @apply(--login-fire-button-icon);
      }
      .btn__text {
        text-align: center;
        width: 100%;
        @apply(--login-fire-button-text);
      }
      .btn__signed-out{
          background-color: transparent;
          color: grey;
          text-align: center;
          width: 170px;
          @apply(--login-fire-btn-signout);
      }
    </style>

    <paper-button class$="btn btn--[[provider]] [[_miniClass]] [[_signOutClass]]" raised$="[[!flat]]">
      <iron-icon class="btn__icon" icon="login-fire-icons:[[provider]]" hidden$="[[_hideIcon]]"></iron-icon>
      <span class="btn__text">[[_text]]</span>
    </paper-button>

    <firebase-auth id="auth"
      app-name="[[appName]]"
      provider="[[provider]]"
      user="{{_user}}"
      status-known="{{_statusKnown}}"
      signed-in="{{_signedIn}}">
    </firebase-auth>
  </template>

  <script>
  Polymer({
    is: 'login-fire-button',
    behaviors: [Convoo.LoginFireSocialBehavior],

    properties: {
      /**
       * Mini format, yes or not.
       *
       * @type {Boolean}
       */
      mini: {
        type: Boolean,
        value: false
      },

      /**
       * Defines if the provider icon must be hidden or not.
       *
       * @type {Boolean}
       */
      _hideIcon: {
        type: Boolean,
        computed: '_computeHideIcon(canSignOut, signedIn)'
      },

      /**
       * CSS class added when the button has mini format.
       *
       * @type {String}
       */
      _miniClass: {
        type: String,
        computed: '_computeMiniClass(mini)'
      },

      /**
       * CSS class added when the log-out button is shown.
       *
       * @type {String}
       */
      _signOutClass: {
        type: String,
        computed: '_computeSignOutClass(canSignOut, signedIn)'
      },

      /**
       * Button text.
       *
       * @type {String}
       */
      _text: {
        type: String,
        computed: '_computeButtonText(_user, config.provider)'
      }
    },

    listeners: {
      'tap': 'signInOrOut'
    },

    /**
     * The provider logo must be hidden if the element can sign out and a user
     * is currently signed in.
     *
     * @param  {Boolean} canSignOut is `true` of the element can signing out
     * @param  {Boolean} signedIn   is `true` if a user is actually signed in
     * @return {Boolean}            `true` if the element can sign out and a
     * user is currently signed in.
     */
    _computeHideIcon: function(canSignOut, signedIn) {
      return canSignOut && signedIn;
    },

    /**
     * Computes the CSS class to add according to the mini format of the
     * element.
     *
     * @param  {Boolean} isMini
     * @return {String}         a CSS class name to add when `isMini` is true,
     * else returns an empty string.
     */
    _computeMiniClass: function(isMini) {
      return isMini ? 'btn--mini' : '';
    },

    /**
     * Compute the CSS class to add when the user is is currently signed in.
     *
     * @param  {Boolean} canSignOut is `true` of the element can signing out
     * @param  {Boolean} signedIn   is `true` if a user is actually signed in
     * @return {String}            a CSS class name to add when `canSignOut` 
     * is true and when signedIn is `true`.
     */
    _computeSignOutClass: function(canSignOut, signedIn) {
      if (canSignOut && signedIn){
          return 'btn__signed-out';
      };
    },

    /**
     * Computes the text to be displayed inside the button.
     *
     * @param  {Object} user     logged-in
     * @param  {Object} provider used for the authentication
     * @return {String}          the text to be displayed inside the button.
     */
    _computeButtonText: function(user, provider) {
      // User logged in.
      if (this.canSignOut && this.signedIn) {
        return 'SIGN OUT';
      }

      // User not logged in and mini format.
      if (this.mini) {
        return provider.name;
      }

      // User not logged in.
      return provider.id !== 'anonymous' ?
        'Sign in with ' + provider.name : 'Sign in ' + provider.name;
    }
  });
  </script>
</dom-module>
